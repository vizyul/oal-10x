<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{{title}}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/images/amplify.ico">
    
    <!-- CSS -->
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/header.css" rel="stylesheet">
    {{#if additionalCSS}}
        {{#each additionalCSS}}
            <link href="{{this}}" rel="stylesheet">
        {{/each}}
    {{/if}}
    
    <!-- Meta tags -->
    <meta name="description" content="{{description}}">
    <meta name="keywords" content="YouTube transcription, video to text, content repurposing AI, YouTube content generator, video transcription to blog, social media content from video, AI, Legacy, Technology, Innovation">
    <meta name="author" content="AmplifyContent.ai">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{title}}">
    <meta property="og:description" content="{{description}}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{canonicalUrl}}">
    <meta property="og:image" content="{{ogimage}}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Transform YouTube videos into 17 ready-to-publish content pieces instantly. AI-powered transcription and content repurposing for creators, marketers, and businesses. Try it for free today.">

    <!-- Twitter Card tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{title}}">
    <meta name="twitter:description" content="{{description}}">
    <meta name="twitter:image" content="{{ogimage}}">
    
    <!-- Additional head content -->
    {{{head}}}
</head>
<body class="{{bodyClass}}">
    <!-- Global Toolbar -->
    {{> header}}
    
    <!-- Additional Header -->
    {{#if showHeader}}
        {{> nav}}
    {{/if}}
    
    <!-- Navigation -->
    {{#if showNav}}
        {{> nav}}
    {{/if}}
    
    <!-- Flash Messages -->
    {{#if flashMessages}}
        <div class="flash-messages">
            {{#each flashMessages.success}}
                <div class="alert alert-success">
                    <span class="alert-icon">✓</span>
                    <span class="alert-message">{{this}}</span>
                </div>
            {{/each}}
            {{#each flashMessages.error}}
                <div class="alert alert-error">
                    <span class="alert-icon">✗</span>
                    <span class="alert-message">{{this}}</span>
                </div>
            {{/each}}
            {{#each flashMessages.warning}}
                <div class="alert alert-warning">
                    <span class="alert-icon">⚠</span>
                    <span class="alert-message">{{this}}</span>
                </div>
            {{/each}}
            {{#each flashMessages.info}}
                <div class="alert alert-info">
                    <span class="alert-icon">ℹ</span>
                    <span class="alert-message">{{this}}</span>
                </div>
            {{/each}}
        </div>
    {{/if}}
    
    <!-- Main Content -->
    <main class="main-content">
        {{{body}}}
    </main>
    
    <!-- Footer -->
    {{> footer}}
    
    <!-- Theme initialization -->
    <script>
        // Initialize theme from server-side data or localStorage
        const serverTheme = '{{userTheme}}' || localStorage.getItem('theme-preference') || 'light';
        document.documentElement.setAttribute('data-theme', serverTheme);
    </script>
    
    <!-- JavaScript -->
    <script src="/js/main.js"></script>
    {{#if additionalJS}}
        {{#each additionalJS}}
            <script src="{{this}}"></script>
        {{/each}}
    {{/if}}

    <!-- RefGrow Affiliate Tracking -->
    <script>
        // Check for referral code in URL and store in session/cookie
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref') || urlParams.get('referral');

            if (refCode) {
                // Store referral code in localStorage for signup form
                localStorage.setItem('referral_code', refCode);

                // Track click via backend API
                fetch('/affiliate/api/track-click', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        referralCode: refCode,
                        landingPage: window.location.href,
                        referrerUrl: document.referrer
                    })
                }).catch(err => console.error('Error tracking affiliate click:', err));
            }

            {{#if user}}
            // User is logged in - track for RefGrow analytics
            console.log('User authenticated:', {
                id: '{{user.id}}',
                email: '{{user.email}}'
            });
            {{/if}}
        })();
    </script>

    <!-- Additional scripts -->
    {{{scripts}}}
</body>
</html>