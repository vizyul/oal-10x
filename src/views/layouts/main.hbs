<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{{title}}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/images/amplify.ico">
    
    <!-- CSS -->
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/header.css" rel="stylesheet">
    {{#if user}}
    <link href="/css/sidebar.css" rel="stylesheet">
    {{/if}}
    {{#if additionalCSS}}
        {{#each additionalCSS}}
            <link href="{{this}}" rel="stylesheet">
        {{/each}}
    {{/if}}
    
    <!-- Meta tags -->
    <meta name="title" content="AmplifyContent.ai - Drop a Video. Get 15+ Content Pieces. In Seconds." />
    <meta name="description" content="{{description}}">
    <meta name="keywords" content="YouTube transcription, video to text, content repurposing AI, YouTube content generator, video transcription to blog, social media content from video, AI, Legacy, Technology, Innovation">
    <meta name="author" content="AmplifyContent.ai">

    <!-- Facebook Domain Verification -->
    <meta name="facebook-domain-verification" content="hjao2pehk2bpzb1wwxi2kutfdmpmq6" />

    <!-- Open Graph -->
    <meta property="og:title" content="{{title}}">
    <meta property="og:description" content="{{description}}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{canonicalUrl}}">
    <meta property="og:image" content="{{ogimage}}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="1200">
    <meta property="og:image:alt" content="{{description}} AI-powered transcription and content repurposing for creators, marketers, and businesses. Try it for free today.">

    <!-- Twitter Card tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{title}}">
    <meta name="twitter:description" content="{{description}}">
    <meta name="twitter:image" content="{{ogimage}}">

    <!-- TikTok Pixel Code Start -->
    <script>
    !function (w, d, t) {
    w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
    var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
    ;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};


    ttq.load('D5ESBUBC77U9G5F6C15G');
    ttq.page();
    }(window, document, 'ttq');
    </script>
    <!-- TikTok Pixel Code End -->
    
    <!-- Additional head content -->
    {{{head}}}
</head>
<body class="{{bodyClass}}{{#if user}} has-sidebar{{/if}}">
    <!-- Global Toolbar -->
    {{> header}}

    <!-- Sidebar (authenticated users only) -->
    {{> sidebar}}

    <!-- Additional Header -->
    {{#if showHeader}}
        {{> nav}}
    {{/if}}

    <!-- Navigation -->
    {{#if showNav}}
        {{> nav}}
    {{/if}}

    <!-- App Layout Container -->
    <div class="app-layout">
        <!-- Flash Messages -->
        {{#if flashMessages}}
            <div class="flash-messages">
                {{#each flashMessages.success}}
                    <div class="alert alert-success">
                        <span class="alert-icon">✓</span>
                        <span class="alert-message">{{this}}</span>
                    </div>
                {{/each}}
                {{#each flashMessages.error}}
                    <div class="alert alert-error">
                        <span class="alert-icon">✗</span>
                        <span class="alert-message">{{this}}</span>
                    </div>
                {{/each}}
                {{#each flashMessages.warning}}
                    <div class="alert alert-warning">
                        <span class="alert-icon">⚠</span>
                        <span class="alert-message">{{this}}</span>
                    </div>
                {{/each}}
                {{#each flashMessages.info}}
                    <div class="alert alert-info">
                        <span class="alert-icon">ℹ</span>
                        <span class="alert-message">{{this}}</span>
                    </div>
                {{/each}}
            </div>
        {{/if}}

        <!-- Main Content -->
        <main class="main-content">
            {{{body}}}
        </main>
    </div>
    
    <!-- Footer -->
    {{> footer}}
    
    <!-- Theme initialization -->
    <script>
        // Initialize theme from server-side data or localStorage
        const serverTheme = '{{userTheme}}' || localStorage.getItem('theme-preference') || 'light';
        document.documentElement.setAttribute('data-theme', serverTheme);
    </script>
    
    <!-- JavaScript -->
    <script src="/js/main.js"></script>
    {{#if user}}
    <script src="/js/sidebar.js"></script>
    {{/if}}
    {{#if additionalJS}}
        {{#each additionalJS}}
            <script src="{{this}}"></script>
        {{/each}}
    {{/if}}

    <!-- RefGrow Affiliate Tracking -->
    <script>
        // Check for referral code in URL and store in session/cookie
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref') || urlParams.get('referral');

            if (refCode) {
                // Store referral code in localStorage for signup form
                localStorage.setItem('referral_code', refCode);

                // Track click via backend API
                fetch('/affiliate/api/track-click', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        referralCode: refCode,
                        landingPage: window.location.href,
                        referrerUrl: document.referrer
                    })
                }).catch(err => console.error('Error tracking affiliate click:', err));
            }

            {{#if user}}
            // User is logged in - track for RefGrow analytics
            console.log('User authenticated:', {
                id: '{{user.id}}',
                email: '{{user.email}}'
            });
            {{/if}}
        })();
    </script>

    <!-- Additional scripts -->
    {{{scripts}}}
</body>
</html>