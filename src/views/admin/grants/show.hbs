<div class="container mx-auto px-4 py-8">
  <div class="mb-6">
    <a href="/admin/grants" class="text-blue-600 hover:underline">&larr; Back to Grants</a>
  </div>

  <div class="max-w-2xl mx-auto">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold">Grant Details</h1>
      {{#if grant.is_active}}
      <form method="POST" action="/admin/grants/{{grant.id}}/revoke" id="revokeForm">
        <button type="button" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700" onclick="confirmRevoke()">
          Revoke Grant
        </button>
      </form>
      {{/if}}
    </div>

    <!-- Status Banner -->
    <div class="mb-6 p-4 rounded-lg {{#if grant.is_active}}bg-green-50 border border-green-200{{else}}bg-gray-50 border border-gray-200{{/if}}">
      <div class="flex items-center">
        <div>
          <p class="font-bold {{#if grant.is_active}}text-green-800{{else}}text-gray-800{{/if}}">
            Status: {{#if grant.is_active}}Active Grant{{else}}Revoked Grant{{/if}}
          </p>
          <p class="text-sm {{#if grant.is_active}}text-green-600{{else}}text-gray-600{{/if}}">
            {{#if grant.expires_at}}
            Expires: {{formatDate grant.expires_at 'MMMM DD, YYYY [at] h:mm A'}}
            {{else}}
            Expires: Never (permanent until revoked)
            {{/if}}
          </p>
        </div>
      </div>
    </div>

    <!-- Grant Info Card -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">Grant Information</h2>

      <div class="space-y-3">
        <p>
          <span class="text-gray-500">Grant Type:</span>
          <span class="ml-2 px-2 py-1 inline-flex text-sm leading-5 font-semibold rounded-full
            {{#if (eq grant.grant_type 'full_access')}}bg-purple-100 text-purple-800{{/if}}
            {{#if (eq grant.grant_type 'unlimited_videos')}}bg-green-100 text-green-800{{/if}}
            {{#if (eq grant.grant_type 'video_limit_override')}}bg-blue-100 text-blue-800{{/if}}
            {{#if (eq grant.grant_type 'trial_extension')}}bg-yellow-100 text-yellow-800{{/if}}">
            {{grant.grant_type}}
          </span>
        </p>

        <p>
          <span class="text-gray-500">Access Details:</span>
          <span class="ml-2 font-medium">
            {{#if (eq grant.grant_type 'full_access')}}
              Tier: {{grant.tier_override}}
            {{/if}}
            {{#if (eq grant.grant_type 'video_limit_override')}}
              {{grant.video_limit_override}} videos/month
            {{/if}}
            {{#if (eq grant.grant_type 'unlimited_videos')}}
              Unlimited videos
            {{/if}}
            {{#if (eq grant.grant_type 'trial_extension')}}
              Extended trial
            {{/if}}
          </span>
        </p>

        <p><span class="text-gray-500">Created:</span> <span class="ml-2 font-medium">{{formatDate grant.created_at 'MMMM DD, YYYY [at] h:mm A'}}</span></p>

        <p><span class="text-gray-500">Last Updated:</span> <span class="ml-2 font-medium">{{formatDate grant.updated_at 'MMMM DD, YYYY [at] h:mm A'}}</span></p>

        <div class="pt-2">
          <span class="text-gray-500">Reason:</span>
          <p class="mt-1 p-3 bg-gray-50 rounded">{{grant.reason}}</p>
        </div>
      </div>
    </div>

    <!-- User Info Card -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">User Information</h2>

      <div class="space-y-3">
        <p><span class="text-gray-500">Email:</span> <span class="ml-2 font-medium">{{grant.user_email}}</span></p>

        <p><span class="text-gray-500">Name:</span> <span class="ml-2 font-medium">{{grant.user_first_name}} {{grant.user_last_name}}</span></p>

        <p><span class="text-gray-500">User ID:</span> <span class="ml-2 font-medium">{{grant.user_id}}</span></p>

        <p><span class="text-gray-500">Current Tier:</span> <span class="ml-2 font-medium">{{grant.user_current_tier}}</span></p>
      </div>

      <div class="mt-4">
        <a href="/admin/grants/new?userId={{grant.user_id}}" class="text-blue-600 hover:underline text-sm">
          Create new grant for this user
        </a>
      </div>
    </div>

    <!-- Admin Info Card -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-bold mb-4">Granted By</h2>

      <div class="space-y-3">
        <p><span class="text-gray-500">Admin Email:</span> <span class="ml-2 font-medium">{{grant.granted_by_email}}</span></p>

        <p><span class="text-gray-500">Admin Name:</span> <span class="ml-2 font-medium">{{grant.granted_by_first_name}} {{grant.granted_by_last_name}}</span></p>
      </div>
    </div>
  </div>
</div>
<p>&nbsp;</p>
<script>
function confirmRevoke() {
  const modal = document.createElement('div');
  modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
  modal.innerHTML = `
    <div class="bg-white rounded-lg p-6 max-w-md mx-4">
      <h3 class="text-lg font-bold mb-4">Confirm Revoke Grant</h3>
      <p class="text-gray-600 mb-6">Are you sure you want to revoke this grant for <strong>{{grant.user_email}}</strong>? This will remove their access immediately.</p>
      <div class="flex justify-end gap-3">
        <button type="button" class="px-4 py-2 border rounded hover:bg-gray-50" onclick="this.closest('.fixed').remove()">Cancel</button>
        <button type="button" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700" onclick="document.getElementById('revokeForm').submit()">Revoke</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
}
</script>
