<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Subscription Management</h1>
  </div>

  <!-- Filter Bar -->
  <div class="bg-white p-4 rounded-lg shadow mb-6">
    <form method="GET" action="/admin/subscriptions" class="flex gap-4">
      <select name="status" class="border rounded px-3 py-2">
        <option value="all" {{#if (eq status 'all')}}selected{{/if}}>All Statuses</option>
        <option value="active" {{#if (eq status 'active')}}selected{{/if}}>Active</option>
        <option value="canceled" {{#if (eq status 'canceled')}}selected{{/if}}>Canceled</option>
        <option value="past_due" {{#if (eq status 'past_due')}}selected{{/if}}>Past Due</option>
        <option value="incomplete" {{#if (eq status 'incomplete')}}selected{{/if}}>Incomplete</option>
      </select>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Filter</button>
    </form>
  </div>

  <!-- Subscriptions Table -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200" style="border: 1px solid #e5e7eb;">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="border: 1px solid #e5e7eb;">User ID</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="border: 1px solid #e5e7eb;">User</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="border: 1px solid #e5e7eb;">Plan</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="border: 1px solid #e5e7eb;">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="border: 1px solid #e5e7eb;">Period</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="border: 1px solid #e5e7eb;">Price</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="border: 1px solid #e5e7eb;">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {{#each subscriptions}}
        <tr>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" style="border: 1px solid #e5e7eb;">
            {{this.user_id}}
          </td>
          <td class="px-6 py-4 whitespace-nowrap" style="border: 1px solid #e5e7eb;">
            <div class="text-sm font-medium text-gray-900">{{this.email}}</div>
            <div class="text-sm text-gray-500">{{this.first_name}} {{this.last_name}}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap" style="border: 1px solid #e5e7eb;">
            <div class="text-sm text-gray-900">{{this.plan_name}}</div>
            <div class="text-sm text-gray-500">{{this.billing_period}}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap" style="border: 1px solid #e5e7eb;">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
              {{#if (eq this.status 'active')}}bg-green-100 text-green-800{{/if}}
              {{#if (eq this.status 'canceled')}}bg-red-100 text-red-800{{/if}}
              {{#if (eq this.status 'past_due')}}bg-yellow-100 text-yellow-800{{/if}}">
              {{this.status}}
            </span>
            {{#if this.cancel_at_period_end}}
            <span class="ml-2 text-xs text-red-600">(Canceling)</span>
            {{/if}}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" style="border: 1px solid #e5e7eb;">
            {{formatDate this.current_period_start 'MMM DD, YYYY'}} - {{formatDate this.current_period_end 'MMM DD, YYYY'}}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" style="border: 1px solid #e5e7eb;">
            {{#if this.price}}${{this.price}}{{else}}-{{/if}}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium" style="border: 1px solid #e5e7eb;">
            <a href="https://dashboard.stripe.com/subscriptions/{{this.stripe_subscription_id}}"
               target="_blank"
               class="text-blue-600 hover:text-blue-900">View in Stripe</a>
          </td>
        </tr>
        {{else}}
        <tr>
          <td colspan="7" class="px-6 py-4 text-center text-gray-500" style="border: 1px solid #e5e7eb;">No subscriptions found</td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {{#if (gt totalPages 1)}}
  <div class="mt-6 flex justify-center gap-2">
    {{#if (gt page 1)}}
    <a href="/admin/subscriptions?status={{status}}&page={{subtract page 1}}&limit={{limit}}"
       class="px-4 py-2 bg-white border rounded hover:bg-gray-50">Previous</a>
    {{/if}}
    <span class="px-4 py-2">Page {{page}} of {{totalPages}}</span>
    {{#if (lt page totalPages)}}
    <a href="/admin/subscriptions?status={{status}}&page={{add page 1}}&limit={{limit}}"
       class="px-4 py-2 bg-white border rounded hover:bg-gray-50">Next</a>
    {{/if}}
  </div>
  {{/if}}
</div>
